<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Voice Editor PWA</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        :root { --accent: #007AFF; --bg: #f2f2f7; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 20px; color: #333; }
        h2 { text-align: center; font-size: 1.2rem; }
        #mic-btn { display: block; width: 70px; height: 70px; border-radius: 50%; border: none; background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); font-size: 30px; margin: 0 auto 20px; }
        .recording { background: #ff3b30 !important; color: white; transform: scale(1.1); }
        #interim-area { min-height: 30px; margin-bottom: 20px; text-align: center; color: #888; font-size: 14px; }
        
        #memo-list { list-style: none; padding: 0; max-width: 500px; margin: 0 auto; }
        .memo-item { background: white; padding: 15px; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        
        /* ç›´æ¥ç·¨é›†ã§ãã‚‹ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .memo-text { 
            font-size: 17px; line-height: 1.5; display: block; margin-bottom: 15px; 
            padding: 5px; border-radius: 5px; outline-color: var(--accent);
        }
        
        .actions { display: flex; gap: 8px; justify-content: flex-end; border-top: 1px solid #eee; padding-top: 10px; }
        .btn { padding: 8px 14px; border-radius: 20px; border: none; font-size: 12px; font-weight: 600; cursor: pointer; }
        .remind-btn { background: #e5f1ff; color: var(--accent); }
        .delete-btn { background: #fff1f0; color: #ff3b30; }
    </style>
</head>
<body>

    <h2>ğŸ™ éŸ³å£°ãƒ¡ãƒ¢ãƒ»ã‚¨ãƒ‡ã‚£ã‚¿</h2>
    <button id="mic-btn">ğŸ™ï¸</button>
    <div id="interim-area">ã‚¿ãƒƒãƒ—ã—ã¦éŒ²éŸ³</div>
    
    <ul id="memo-list"></ul>

    <script>
        const micBtn = document.getElementById('mic-btn');
        const interimArea = document.getElementById('interim-area');
        const memoList = document.getElementById('memo-list');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'ja-JP';
        recognition.interimResults = true;
        recognition.continuous = true;

        let isRecording = false;

        micBtn.onclick = () => {
            if (!isRecording) { recognition.start(); } else { recognition.stop(); }
        };

        recognition.onstart = () => { isRecording = true; micBtn.classList.add('recording'); interimArea.innerText = "èãå–ã‚Šä¸­..."; };
        recognition.onend = () => { isRecording = false; micBtn.classList.remove('recording'); interimArea.innerText = "ã‚¿ãƒƒãƒ—ã—ã¦éŒ²éŸ³"; };

        recognition.onresult = (event) => {
            let finalTranscript = '';
            for (let i = event.resultIndex; i < event.results.length; i++) {
                if (event.results[i].isFinal) { finalTranscript += event.results[i][0].transcript; }
            }
            if (finalTranscript) { saveMemo(finalTranscript); renderMemos(); }
        };

        // ä¿å­˜
        function saveMemo(text) {
            const memos = JSON.parse(localStorage.getItem('my-memos') || '[]');
            memos.unshift({ id: Date.now(), text: text });
            localStorage.setItem('my-memos', JSON.stringify(memos));
        }

        // ç·¨é›†å†…å®¹ã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
        function updateMemo(id, newText) {
            const memos = JSON.parse(localStorage.getItem('my-memos') || '[]');
            const index = memos.findIndex(m => m.id === id);
            if (index !== -1) {
                memos[index].text = newText;
                localStorage.setItem('my-memos', JSON.stringify(memos));
            }
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼/ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼é€£æºã®æ”¹å–„ç‰ˆ
        function openCalendar(text) {
            const title = encodeURIComponent(text);
            // Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã€Œä½œæˆç”»é¢ã€ã‚’å‘¼ã³å‡ºã™URLï¼ˆã“ã‚ŒãŒä¸€ç•ªæ—¥æ™‚ç·¨é›†ã—ã‚„ã™ã„ã§ã™ï¼‰
            // ã‚‚ã—ç´”æ­£ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒè‰¯ã‘ã‚Œã°åˆ¥ã®æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã¾ãšã¯ä¸€ç•ªç¢ºå®Ÿãªã“ã¡ã‚‰ã‚’ã€‚
            const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}`;
            window.open(url, '_blank');
        }

        function renderMemos() {
            const memos = JSON.parse(localStorage.getItem('my-memos') || '[]');
            memoList.innerHTML = memos.map(m => `
                <li class="memo-item">
                    <span class="memo-text" 
                          contenteditable="true" 
                          onblur="updateMemo(${m.id}, this.innerText)">${m.text}</span>
                    <div class="actions">
                        <button class="btn remind-btn" onclick="openCalendar('${m.text.replace(/'/g, "\\'")}')">ğŸ“… æ—¥æ™‚æŒ‡å®š</button>
                        <button class="btn delete-btn" onclick="deleteMemo(${m.id})">å‰Šé™¤</button>
                    </div>
                </li>
            `).join('');
        }

        function deleteMemo(id) {
            if(confirm("ã“ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
                const memos = JSON.parse(localStorage.getItem('my-memos') || '[]');
                localStorage.setItem('my-memos', JSON.stringify(memos.filter(m => m.id !== id)));
                renderMemos();
            }
        }

        renderMemos();
    </script>
</body>
</html>

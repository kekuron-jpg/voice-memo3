<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Voice Memo PWA</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        body { font-family: sans-serif; background: #f2f2f7; padding: 20px; text-align: center; }
        #mic-btn { width: 100px; height: 100px; border-radius: 50%; border: none; background: white; shadow: 0 4px 10px rgba(0,0,0,0.1); font-size: 40px; margin: 20px 0; }
        .recording { background: #ff3b30 !important; color: white; }
        #status { color: #888; min-height: 1.5em; margin-bottom: 20px; font-size: 14px; }
        #memo-list { list-style: none; padding: 0; text-align: left; max-width: 400px; margin: 0 auto; }
        .memo-item { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn { color: red; border: none; background: none; }
    </style>
</head>
<body>

    <h2>Èü≥Â£∞„É°„É¢</h2>
    <div id="status">„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶Ë©±„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
    <button id="mic-btn">üéôÔ∏è</button>

    <ul id="memo-list"></ul>

    <script>
        const micBtn = document.getElementById('mic-btn');
        const status = document.getElementById('status');
        const memoList = document.getElementById('memo-list');

        // Èü≥Â£∞Ë™çË≠ò„ÅÆË®≠ÂÆö
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            status.innerText = "‚ùå „Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈü≥Â£∞Ë™çË≠ò„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì";
        } else {
            const recognition = new SpeechRecognition();
            recognition.lang = 'ja-JP';
            recognition.continuous = false; // Âñã„ÇäÁµÇ„Çè„Å£„Åü„ÇâËá™ÂãïÂÅúÊ≠¢
            recognition.interimResults = false;

            let isRecording = false;

            micBtn.onclick = () => {
                if (!isRecording) {
                    try {
                        recognition.start();
                    } catch (e) {
                        status.innerText = "„Ç®„É©„Éº: " + e.message;
                    }
                } else {
                    recognition.stop();
                }
            };

            recognition.onstart = () => {
                isRecording = true;
                micBtn.classList.add('recording');
                status.innerText = "üéôÔ∏è ËÅû„ÅçÂèñ„Çä‰∏≠...ÔºàË©±„ÅóÁµÇ„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºâ";
            };

            recognition.onend = () => {
                isRecording = false;
                micBtn.classList.remove('recording');
                status.innerText = "‰øùÂ≠ò„Åó„Åæ„Åó„Åü";
                setTimeout(() => { status.innerText = "„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶Ë©±„Åó„Å¶„Åè„Å†„Åï„ÅÑ"; }, 2000);
            };

            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                if (text) {
                    saveMemo(text);
                    renderMemos();
                }
            };

            recognition.onerror = (event) => {
                status.innerText = "‚ùå „Ç®„É©„ÉºÁô∫Áîü: " + event.error;
                isRecording = false;
                micBtn.classList.remove('recording');
            };
        }

        function saveMemo(text) {
            const memos = JSON.parse(localStorage.getItem('my-memos') || '[]');
            memos.unshift({ id: Date.now(), text: text });
            localStorage.setItem('my-memos', JSON.stringify(memos));
        }

        function renderMemos() {
            const memos = JSON.parse(localStorage.getItem('my-memos') || '[]');
            memoList.innerHTML = memos.map(m => `
                <li class="memo-item">
                    <span>${m.text}</span>
                    <button class="delete-btn" onclick="deleteMemo(${m.id})">ÂâäÈô§</button>
                </li>
            `).join('');
        }

        function deleteMemo(id) {
            const memos = JSON.parse(localStorage.getItem('my-memos') || '[]');
            const filtered = memos.filter(m => m.id !== id);
            localStorage.setItem('my-memos', JSON.stringify(filtered));
            renderMemos();
        }

        renderMemos();
    </script>
</body>
</html>
